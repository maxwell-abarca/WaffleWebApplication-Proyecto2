create table EXCEPCION
(
	ID int not null
		primary key,
	MENSAJE nvarchar(150) not null
)
go

create table ROL
(
	ID int not null
		primary key,
	DESCRIPCION nvarchar(50) not null
)
go

create table TBL_BITACORA
(
	USUARIO nvarchar(50) not null,
	ACCION nvarchar(150) not null,
	FECHA_ACCION date not null
)
go

create table TBL_CADENA
(
	ID int identity
		primary key,
	CEDULA_DUENO int,
	NOMBRE nvarchar(50),
	LOGO nvarchar(200)
)
go

create table TBL_CATEGORIA
(
	ID_CATEGORIA int not null
		primary key,
	NOMBRE_CATEGORIA nvarchar(50) not null
)
go

create table TBL_COMERCIO
(
	CEDULA_JURIDICA int not null
		primary key,
	CEDULA_DUENO int not null,
	ID_CATEGORIA int not null,
	NOMBRE_COMERCIAL nvarchar(50) not null,
	REGIMEN_TRIBUTARIO nvarchar(50) not null,
	TELEFONO nvarchar(50) not null,
	DIRECCION_ESCRITA nvarchar(50) not null,
	HORA_APERTURA nvarchar(50) not null,
	HORA_CIERRE nvarchar(50) not null,
	FECHA_CREACION date not null,
	ESTADO nvarchar(50) not null,
	FOTO nvarchar(200) not null,
	ID_CADENA int not null,
	ID_DIRECCION int
)
go

create table TBL_DIRECCION
(
	ID int identity
		primary key,
	LATITUD float not null,
	LONGITUD float not null
)
go

create table TBL_FLOTILLA
(
	ID int identity
		constraint TBL_FLOTILLA_pk
			primary key nonclustered,
	NOMBRE nvarchar(50),
	CEDULA_DUENO int
)
go

create table TBL_MEMBRESIA_COMERCIO
(
	ID_MEMBRESIA int not null
		primary key,
	CEDULA_COMERCIO int not null
		references TBL_COMERCIO,
	CEDULA_DUENO int not null,
	MONTO_MEMBRESIA int not null,
	FECHA_INICIO date not null,
	FECHA_FIN date not null,
	COMISION int not null,
	IMPUESTO int not null,
	CORREO nvarchar(100) not null
)
go

create table TBL_PRODUCTO
(
	ID_PRODUCTO nvarchar(50) not null
		primary key,
	NOMBRE_PRODUCTO nvarchar(50) not null,
	ID_CATEGORIA int not null
		references TBL_CATEGORIA,
	PRECIO int not null,
	IMAGEN nvarchar(300) not null,
	CEDULA_COMERCIO int not null
		references TBL_COMERCIO,
	ESTADO nvarchar(50) not null
)
go

create table TBL_PROMOCION
(
	CODIGO nvarchar(50) not null
		primary key,
	ID_PRODUCTO nvarchar(50),
	DESCUENTO float,
	ESTADO nvarchar(50) not null,
	ID_COMERCIO int
		constraint TBL_PROMOCION_TBL_COMERCIO_CEDULA_JURIDICA_fk
			references TBL_COMERCIO
				on update cascade on delete cascade
)
go

create table USUARIO
(
	CEDULA int not null
		primary key,
	NOMBRE nvarchar(50) not null,
	PRIMER_APELLIDO nvarchar(50) not null,
	SEGUNDO_APELLIDO nvarchar(50) not null,
	FECHA_NACIMIENTO date not null,
	CORREO nvarchar(50) not null,
	CONTRASENA nvarchar(50) not null,
	TELEFONO nvarchar(50) not null,
	FOTO_PERFIL nvarchar(300),
	ESTADO nvarchar(50) not null,
	TIPO_IDENTIFICACION nvarchar(50) not null,
	CODIGO_VERIFICACION nvarchar(50) not null
)
go

create table TBL_DIRECCION_USUARIO
(
	ID int identity
		primary key,
	LATITUD float,
	LONGITUD float,
	ID_USUARIO int
		references USUARIO
			on update cascade on delete cascade
)
go

create table TBL_HISTORIAL_CONTRASENA
(
	ID_USUARIO int
		references USUARIO
			on update cascade on delete cascade,
	CONTRASENA nvarchar(50)
)
go

create table TBL_MEMBRESIA_TRANSPORTISTA
(
	ID_MEMBRESIA int not null
		primary key,
	CEDULA_USUARIO int not null
		references USUARIO,
	MONTO_MEMBRESIA int not null,
	FECHA_INICIO date not null,
	FECHA_FIN date not null,
	COMISION_BASE int not null,
	MONTO_KILOMETRAJE int not null,
	IMPUESTO int not null,
	TIPO_MEMBRESIA nvarchar(50) not null
)
go

create table TBL_VEHICULO
(
	ID int identity
		primary key,
	PLACA nvarchar(50),
	MARCA nvarchar(50) not null,
	MODELO nvarchar(50) not null,
	TIPO_VEHICULO nvarchar(50) not null,
	CEDULA_DUENO int
		constraint TBL_VEHICULO_USUARIO_CEDULA_fk
			references USUARIO
				on update cascade on delete cascade,
	ID_FLOTILLA int
		constraint TBL_VEHICULO_TBL_FLOTILLA_ID_fk
			references TBL_FLOTILLA
				on update cascade on delete cascade
)
go

create table USUARIOSxROL
(
	CEDULA_USUARIO int
		references USUARIO
			on update cascade on delete cascade,
	ID_ROL int
		references ROL
			on update cascade
)
go


--INSERT EN BITACORA
CREATE PROCEDURE [dbo].[CRE_BITACORA_PR]
	@P_USUARIO NVARCHAR(50),
	@P_ACCION NVARCHAR(150),
	@P_FECHA_ACCION DATE
AS
	INSERT INTO [dbo].[TBL_BITACORA] VALUES(@P_USUARIO,@P_ACCION,@P_FECHA_ACCION);
go

CREATE PROCEDURE [dbo].[CRE_CADENA_PR]
                                       @P_CEDULA_DUENO INT,
                                       @P_NOMBRE NVARCHAR(50),
                                       @P_LOGO NVARCHAR(200)
AS
INSERT INTO [dbo].[TBL_CADENA] (CEDULA_DUENO, NOMBRE, LOGO)
VALUES (@P_CEDULA_DUENO,@P_NOMBRE,@P_LOGO);
go

--INSERT EN CATEGORIA
CREATE PROCEDURE [dbo].[CRE_CATEGORIA_PR]
@P_ID_CATEGORIA INT,
	@P_NOMBRE_CATEGORIA NVARCHAR(50)
AS
	INSERT INTO [dbo].[TBL_CATEGORIA] VALUES(@P_ID_CATEGORIA,@P_NOMBRE_CATEGORIA);
go

--INSERT EN COMERCIO
CREATE   PROCEDURE [dbo].[CRE_COMERCIO_PR] 
    @P_CEDULA_JURIDICA INT,
    @P_CEDULA_DUENO INT,
    @P_ID_CADENA INT,
    @P_ID_CATEGORIA INT,
    @P_ID_DIRECCION INT,
    @P_NOMBRE_COMERCIAL NVARCHAR(50),
    @P_REGIMEN_TRIBUTARIO NVARCHAR(50),
    @P_TELEFONO NVARCHAR(50),
    @P_DIRECCION_ESCRITA NVARCHAR(50),
    @P_HORA_APERTURA NVARCHAR(50),
    @P_HORA_CIERRE NVARCHAR(50),
    @P_FECHA_CREACION DATE,
    @P_ESTADO NVARCHAR(50),
    @P_FOTO NVARCHAR(200)
AS
INSERT INTO [dbo].TBL_COMERCIO
VALUES ( @P_CEDULA_JURIDICA, @P_CEDULA_DUENO, @P_ID_CATEGORIA, @P_NOMBRE_COMERCIAL, @P_REGIMEN_TRIBUTARIO, @P_TELEFONO
       , @P_DIRECCION_ESCRITA, @P_HORA_APERTURA, @P_HORA_CIERRE
       , @P_FECHA_CREACION, @P_ESTADO, @P_FOTO, @P_ID_CADENA, @P_ID_DIRECCION);
go

CREATE   PROCEDURE [dbo].[CRE_DIRECCION_PROC]
	@P_LATITUD FLOAT,
	@P_LONGITUD FLOAT

AS
	INSERT INTO [dbo].[TBL_DIRECCION] VALUES(@P_LATITUD, @P_LONGITUD);
go

CREATE PROCEDURE [dbo].[CRE_DIRECCION_USUARIO_PR] @P_LATITUD FLOAT,
                                                  @P_LONGITUD FLOAT,
                                                  @P_ID_USUARIO INT
AS
INSERT INTO TBL_DIRECCION_USUARIO(LATITUD, LONGITUD, ID_USUARIO)
VALUES (@P_LATITUD, @P_LONGITUD, @P_ID_USUARIO)
go

CREATE PROCEDURE [dbo].[CRE_FLOTILLA_PR]
@P_NOMBRE NVARCHAR(50),
@P_CEDULA_DUENO INT
AS INSERT INTO TBL_FLOTILLA(NOMBRE, CEDULA_DUENO) VALUES(@P_NOMBRE,@P_CEDULA_DUENO);
go

 CREATE PROCEDURE [dbo].[CRE_MEMBRESIA_COMERCIO_PR]
	@P_ID_MEMBRESIA INT,
	@P_CEDULA_COMERCIO INT,
	@P_CEDULA_DUENO INT,
    @P_MONTO_MEMBRESIA INT,
	@P_FECHA_INICIO DATE,
	@P_FECHA_FIN DATE,
	@P_COMISION INT,
    @P_IMPUESTO INT,
	@P_CORREO NVARCHAR(100)
AS
	INSERT INTO [dbo].[TBL_MEMBRESIA_COMERCIO] VALUES(@P_ID_MEMBRESIA,@P_CEDULA_COMERCIO,@P_CEDULA_DUENO,@P_MONTO_MEMBRESIA,@P_FECHA_INICIO,@P_FECHA_FIN,@P_COMISION,@P_IMPUESTO,@P_CORREO);
go

--INSERT EN MEMBRESIA_TRANSPORTISTA
CREATE PROCEDURE [dbo].[CRE_MEMBRESIA_TRANSPORTISTA_PR]
	@P_ID_MEMBRESIA INT,
	@P_CEDULA_USUARIO INT,
    @P_MONTO_MEMBRESIA INT,
	@P_FECHA_INICIO DATE,
	@P_FECHA_FIN DATE,
	@P_COMISION_BASE INT,
	@P_MONTO_KILOMETRAJE INT,
    @P_IMPUESTO INT,
	@P_TIPO_MEMBRESIA NVARCHAR(50)
AS
	INSERT INTO [dbo].[TBL_MEMBRESIA_TRANSPORTISTA] VALUES(@P_ID_MEMBRESIA,@P_CEDULA_USUARIO,@P_MONTO_MEMBRESIA,@P_FECHA_INICIO,@P_FECHA_FIN,@P_COMISION_BASE,@P_MONTO_KILOMETRAJE,@P_IMPUESTO,@P_TIPO_MEMBRESIA);
go

--INSERT EN PRODUCTO
CREATE PROCEDURE [dbo].[CRE_PRODUCTO_PR]
	@P_ID_PRODUCTO NVARCHAR(25),
	@P_NOMBRE_PRODUCTO NVARCHAR(25),
	@P_ID_CATEGORIA INT,
	@P_PRECIO INT,
	@P_IMAGEN NVARCHAR(300),
	@P_CEDULA_COMERCIO INT,
	@P_ESTADO NVARCHAR(25)
AS
	INSERT INTO [dbo].[TBL_PRODUCTO] VALUES(@P_ID_PRODUCTO,@P_NOMBRE_PRODUCTO,@P_ID_CATEGORIA,@P_PRECIO,@P_IMAGEN,@P_CEDULA_COMERCIO,@P_ESTADO);
go

CREATE PROCEDURE [dbo].[CRE_PROMOCION_PR] @P_CODIGO NVARCHAR(50),
                                          @P_ID_PRODUCTO NVARCHAR(50),
                                          @P_DESCUENTO FLOAT,
                                          @P_ESTADO NVARCHAR(50),
                                          @P_ID_COMERCIO INT
AS
INSERT INTO [dbo].[TBL_PROMOCION]
VALUES (@P_CODIGO, @P_ID_PRODUCTO, @P_DESCUENTO, @P_ESTADO,@P_ID_COMERCIO);
go

--INSERT EN USUARIO
CREATE PROCEDURE [dbo].[CRE_USUARIO_PR] @P_CEDULA INT,
                                        @P_NOMBRE NVARCHAR(50),
                                        @P_PRIMER_APELLIDO NVARCHAR(50),
                                        @P_SEGUNDO_APELLIDO NVARCHAR(50),
                                        @P_FECHA_NACIMIENTO DATE,
                                        @P_CORREO NVARCHAR(50),
                                        @P_CONTRASENA NVARCHAR(50),
                                        @P_TELEFONO NVARCHAR(50),
                                        @P_FOTO_PERFIL NVARCHAR(200),
                                        @P_ESTADO NVARCHAR(50),
                                        @P_TIPO_IDENTIFICACION NVARCHAR(50),
                                        @P_CODIGO_VERIFICACION NVARCHAR(50),
                                        @P_ID_ROL INT
AS
INSERT INTO [dbo].[USUARIO]
VALUES (@P_CEDULA, @P_NOMBRE, @P_PRIMER_APELLIDO, @P_SEGUNDO_APELLIDO,
        @P_FECHA_NACIMIENTO, @P_CORREO, @P_CONTRASENA, @P_TELEFONO, @P_FOTO_PERFIL,
        @P_ESTADO, @P_TIPO_IDENTIFICACION, @P_CODIGO_VERIFICACION);

INSERT INTO USUARIOSxROL
VALUES (@P_CEDULA, @P_ID_ROL);

INSERT INTO TBL_HISTORIAL_CONTRASENA(ID_USUARIO, CONTRASENA)
VALUES (@P_CEDULA, @P_CONTRASENA)
go

CREATE PROCEDURE [dbo].[CRE_VEHICULO_PR] @P_PLACA NVARCHAR(50),
                                         @P_MARCA NVARCHAR(50),
                                         @P_MODELO NVARCHAR(50),
                                         @P_TIPO_VEHICULO NVARCHAR(50),
                                         @P_CEDULA_DUENO INT,
                                         @P_ID_FLOTILLA INT
AS
INSERT INTO TBL_VEHICULO(PLACA, MARCA, MODELO, TIPO_VEHICULO, CEDULA_DUENO,ID_FLOTILLA)
VALUES (@P_PLACA, @P_MARCA, @P_MODELO, @P_TIPO_VEHICULO, @P_CEDULA_DUENO, @P_ID_FLOTILLA);
go

CREATE PROCEDURE [dbo].[CRE_VEHICULO_SIN_FLOTILLA_PR] @P_PLACA NVARCHAR(50),
                                                      @P_MARCA NVARCHAR(50),
                                                      @P_MODELO NVARCHAR(50),
                                                      @P_TIPO_VEHICULO NVARCHAR(50),
                                                      @P_CEDULA_DUENO INT
AS
INSERT INTO TBL_VEHICULO(PLACA, MARCA, MODELO, TIPO_VEHICULO, CEDULA_DUENO)
VALUES (@P_PLACA, @P_MARCA, @P_MODELO, @P_TIPO_VEHICULO, @P_CEDULA_DUENO)
go

CREATE PROCEDURE [dbo].[DEL_FLOTILLA_PR] @P_NOMBRE NVARCHAR(50)
AS
DELETE
FROM TBL_FLOTILLA
WHERE NOMBRE = @P_NOMBRE;
go

CREATE PROCEDURE [dbo].[DEL_PROMOCION_PR] @P_CODIGO NVARCHAR(50)
AS
DELETE
FROM [dbo].[TBL_PROMOCION]
WHERE @P_CODIGO = CODIGO;
go

CREATE PROCEDURE [dbo].[DEL_TRANSPORTISTA_PR] @P_CEDULA INT
AS
DELETE
FROM USUARIOSxROL
WHERE @P_CEDULA = CEDULA_USUARIO
DELETE
FROM USUARIO
WHERE @P_CEDULA = CEDULA;
go

CREATE PROCEDURE [dbo].[DEL_VEHICULO_PR] @P_PLACA NVARCHAR(50)
as
delete
from TBL_VEHICULO
where PLACA = @P_PLACA;
go

CREATE PROCEDURE [dbo].[GET_USUARIO_PROC] @P_CORREO NVARCHAR(50),
                                      @P_CONTRASENA NVARCHAR(50)
AS
SELECT CEDULA,
       NOMBRE,
       PRIMER_APELLIDO,
       SEGUNDO_APELLIDO,
       FECHA_NACIMIENTO,
       CORREO,
       CONTRASENA,
       TELEFONO,
       FOTO_PERFIL,
       ESTADO,
       TIPO_IDENTIFICACION,
       CODIGO_VERIFICACION,
       USUARIOSxROL.ID_ROL
FROM USUARIO,
     USUARIOSxROL
WHERE CORREO = @P_CORREO
  AND CONTRASENA = @P_CONTRASENA
  AND USUARIO.CEDULA = USUARIOSxROL.CEDULA_USUARIO;
go

--RETRIEVE ALL BITACORA
CREATE PROCEDURE [dbo].[RET_ALL_BITACORA_PR]
AS
	SELECT USUARIO,ACCION,FECHA_ACCION FROM TBL_BITACORA;
go

CREATE PROCEDURE [dbo].[RET_ALL_CADENA_PR]
AS
    SELECT ID, CEDULA_DUENO, NOMBRE, LOGO  FROM TBL_CADENA;
go

--RETRIEVE ALL CATEGORIA
CREATE PROCEDURE [dbo].[RET_ALL_CATEGORIA_PR]
AS
	SELECT ID_CATEGORIA,NOMBRE_CATEGORIA FROM TBL_CATEGORIA;
go

CREATE   PROCEDURE [dbo].[RET_ALL_COMERCIO_PR]
AS 
SELECT * FROM [dbo].[TBL_COMERCIO]
go

CREATE PROCEDURE [dbo].[RET_ALL_EXCEPCION_PROC]
AS
	SELECT ID, MENSAJE FROM EXCEPCION;
go

CREATE PROCEDURE [RET_ALL_FLOTILLA_PR]
AS
SELECT ID, NOMBRE, CEDULA_DUENO
FROM TBL_FLOTILLA;
go

CREATE   PROCEDURE [dbo].[RET_ALL_INACTIVOS_PR]
    @P_ESTADO NVARCHAR(50)
AS
SELECT CEDULA,
       NOMBRE,
       PRIMER_APELLIDO,
       SEGUNDO_APELLIDO,
       FECHA_NACIMIENTO,
       CORREO,
       CONTRASENA,
       TELEFONO,
       FOTO_PERFIL,
       ESTADO,
       TIPO_IDENTIFICACION,
       CODIGO_VERIFICACION,
       USUARIOSxROL.ID_ROL
FROM USUARIO,
     USUARIOSxROL
WHERE USUARIO.CEDULA=USUARIOSxROL.CEDULA_USUARIO AND USUARIOSxROL.ID_ROL = '2' AND ESTADO = @P_ESTADO;
go

--RETRIEVE ALL PRODUCTO
CREATE PROCEDURE [dbo].[RET_ALL_MEMBRESIA_TRANSPORTISTA_PR]
AS
	SELECT * from tbl_MEMBRESIA_TRANSPORTISTA;
go

CREATE   PROCEDURE [dbo].[RET_ALL_PRODUCTO_PR]
AS
	SELECT * FROM TBL_PRODUCTO;
go

CREATE PROCEDURE [dbo].[RET_ALL_PROMOCION_PR]
AS
SELECT CODIGO, ID_PRODUCTO, DESCUENTO,ESTADO,ID_COMERCIO
FROM TBL_PROMOCION;
go

CREATE PROCEDURE [dbo].[RET_ALL_USUARIO_PR]
AS
SELECT CEDULA,
       NOMBRE,
       PRIMER_APELLIDO,
       SEGUNDO_APELLIDO,
       FECHA_NACIMIENTO,
       CORREO,
       CONTRASENA,
       TELEFONO,
       FOTO_PERFIL,
       ESTADO,
       TIPO_IDENTIFICACION,
       CODIGO_VERIFICACION,
       USUARIOSxROL.ID_ROL
FROM USUARIO,
     USUARIOSxROL
WHERE USUARIO.CEDULA=USUARIOSxROL.CEDULA_USUARIO;
go

CREATE PROCEDURE [dbo].[RET_ALL_VEHICULO_PR]
AS
SELECT TBL_VEHICULO.ID,
       PLACA,
       MARCA,
       MODELO,
       TIPO_VEHICULO,
       TBL_VEHICULO.CEDULA_DUENO,
       ID_FLOTILLA,
       NOMBRE
FROM TBL_VEHICULO,
     TBL_FLOTILLA
WHERE ID_FLOTILLA = TBL_FLOTILLA.ID;
go

CREATE   PROCEDURE [dbo].[RET_CADENA_USUARIO_PROC]
	@P_CEDULA_DUENO INT
AS 
    SELECT ID, CEDULA_DUENO, NOMBRE, LOGO FROM [dbo].[TBL_CADENA] WHERE @P_CEDULA_DUENO=CEDULA_DUENO;
go

--RET CATEGORIA BY ID
CREATE PROCEDURE [dbo].[RET_CATEGORIA_PR]
	@P_ID_CATEGORIA nvarchar(25)
AS
	SELECT ID_CATEGORIA,NOMBRE_CATEGORIA FROM TBL_CATEGORIA WHERE ID_CATEGORIA = @P_ID_CATEGORIA;
go

CREATE PROCEDURE [dbo].[RET_CEDULA_USUARIO_PR]
@P_CEDULA INT
AS 
SELECT CEDULA,NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,FECHA_NACIMIENTO,
CORREO,CONTRASENA,TELEFONO,FOTO_PERFIL,ESTADO,TIPO_IDENTIFICACION,CODIGO_VERIFICACION,ID_ROL FROM
[dbo].[USUARIO],USUARIOSxROL
WHERE CEDULA=@P_CEDULA AND CEDULA=USUARIOSxROL.CEDULA_USUARIO;
go

CREATE   PROCEDURE [dbo].[RET_COMERCIOS_DUENO_PR]
    @P_CEDULA_DUENO INT
AS 
    SELECT * FROM [dbo].[TBL_COMERCIO] WHERE @P_CEDULA_DUENO = CEDULA_DUENO;
go

CREATE PROCEDURE [dbo].[RET_COMERCIO_SOLICITUDES_PR]
AS 
SELECT * FROM [dbo].[TBL_COMERCIO] where Estado = 'EST_INACTIVO'
go

 CREATE PROCEDURE [dbo].[RET_DIRECCION_PR] @P_ID INT
AS
SELECT ID, LATITUD, LONGITUD
FROM TBL_DIRECCION
WHERE @P_ID = ID;
go

CREATE   PROCEDURE [dbo].[RET_DIRECCION_PROC]
	@P_LATITUD FLOAT,
	@P_LONGITUD FLOAT
AS
	SELECT ID, LATITUD, LONGITUD FROM [dbo].[TBL_DIRECCION] WHERE LATITUD = @P_LATITUD AND LONGITUD = @P_LONGITUD;
go

CREATE PROCEDURE [dbo].[RET_DIRECCION_USUARIO_PR] @P_ID_USUARIO INT
AS
SELECT ID, LATITUD, LONGITUD, ID_USUARIO
FROM TBL_DIRECCION_USUARIO
WHERE @P_ID_USUARIO = ID_USUARIO;
go

CREATE PROCEDURE [dbo].[RET_EXCEPCION_PROC]
	@P_ID INT
AS
	SELECT ID,MENSAJE FROM EXCEPCION WHERE ID=@P_ID;
go

CREATE PROCEDURE [dbo].[RET_FLOTILLA_PR] @P_CEDULA_DUENO INT
AS
SELECT ID, NOMBRE, CEDULA_DUENO
FROM TBL_FLOTILLA
WHERE CEDULA_DUENO = @P_CEDULA_DUENO;
go

CREATE PROCEDURE [dbo].[RET_MIS_FLOTILLAS_PR] @P_CEDULA_DUENO INT
AS
SELECT ID, NOMBRE, CEDULA_DUENO
FROM TBL_FLOTILLA
WHERE CEDULA_DUENO = @P_CEDULA_DUENO;
go

CREATE PROCEDURE [dbo].[RET_MIS_PROMOCIONES_PR] @P_ID_COMERCIO INT
AS
SELECT CODIGO, TBL_PROMOCION.ID_PRODUCTO, DESCUENTO, TBL_PROMOCION.ESTADO, ID_COMERCIO, NOMBRE_PRODUCTO
FROM TBL_PROMOCION,
     TBL_PRODUCTO
WHERE ID_COMERCIO = @P_ID_COMERCIO AND TBL_PROMOCION.ID_PRODUCTO=TBL_PRODUCTO.ID_PRODUCTO;
go

CREATE PROCEDURE [dbo].[RET_MIS_VEHICULOS_PR] @P_CEDULA_DUENO INT
AS
SELECT TBL_VEHICULO.ID,
       PLACA,
       MARCA,
       MODELO,
       TIPO_VEHICULO,
       TBL_VEHICULO.CEDULA_DUENO,
       ID_FLOTILLA,
       NOMBRE
FROM TBL_VEHICULO,
     TBL_FLOTILLA

WHERE @P_CEDULA_DUENO = TBL_FLOTILLA.CEDULA_DUENO
  AND ID_FLOTILLA = TBL_FLOTILLA.ID;
go

--RET PRODUCTO BY ID
CREATE   PROCEDURE [dbo].[RET_PRODUCTOS_POR_COMERCIOS_PR]
	@P_CEDULA_COMERCIO INT
AS
	SELECT * FROM TBL_PRODUCTO WHERE CEDULA_COMERCIO = @P_CEDULA_COMERCIO;
go

--RET PRODUCTO BY ID
CREATE PROCEDURE [dbo].[RET_PRODUCTO_PR]
	@P_ID_PRODUCTO nvarchar(25)
AS
	SELECT ID_PRODUCTO,NOMBRE_PRODUCTO, ID_CATEGORIA,PRECIO,IMAGEN,ID_COMERCIO,ESTADO FROM TBL_PRODUCTO WHERE ID_PRODUCTO = @P_ID_PRODUCTO;
go

CREATE PROCEDURE [dbo].[RET_PROMOCION_PR] @P_CODIGO NVARCHAR(50)
AS
SELECT CODIGO, ID_PRODUCTO, DESCUENTO
FROM TBL_PROMOCION
WHERE @P_CODIGO = CODIGO;
go

CREATE PROCEDURE [dbo].[RET_TRANSPORTISTA_PR] @P_ID_ROL INT
AS
SELECT CEDULA,
       NOMBRE,
       PRIMER_APELLIDO,
       SEGUNDO_APELLIDO,
       FECHA_NACIMIENTO,
       CORREO,
       CONTRASENA,
       TELEFONO,
       FOTO_PERFIL,
       ESTADO,
       TIPO_IDENTIFICACION,
       CODIGO_VERIFICACION,
       CEDULA_USUARIO,
       ID_ROL
FROM USUARIO,
     USUARIOSxROL
WHERE CEDULA = USUARIOSxROL.CEDULA_USUARIO
  AND @P_ID_ROL = ID_ROL;
go

CREATE PROCEDURE [dbo].[RET_TRANSPORTISTA_SOLICITUDES_PR] @P_ID_ROL INT
AS
SELECT CEDULA,
       NOMBRE,
       PRIMER_APELLIDO,
       SEGUNDO_APELLIDO,
       FECHA_NACIMIENTO,
       CORREO,
       CONTRASENA,
       TELEFONO,
       FOTO_PERFIL,
       ESTADO,
       TIPO_IDENTIFICACION,
       CODIGO_VERIFICACION,
       CEDULA_USUARIO,
       ID_ROL
FROM USUARIO,
     USUARIOSxROL
WHERE CEDULA = USUARIOSxROL.CEDULA_USUARIO
  AND @P_ID_ROL = ID_ROL AND ESTADO = 'EST_INACTIVO';
go

CREATE PROCEDURE [dbo].[RET_USUARIO_CODIGO_PR] @P_CODIGO_VERIFICACION NVARCHAR(50)
AS
SELECT CEDULA,
       NOMBRE,
       PRIMER_APELLIDO,
       SEGUNDO_APELLIDO,
       FECHA_NACIMIENTO,
       CORREO,
       CONTRASENA,
       TELEFONO,
       FOTO_PERFIL,
       ESTADO,
       TIPO_IDENTIFICACION,
       CODIGO_VERIFICACION,
       USUARIOSxROL.ID_ROL
FROM [dbo].[USUARIO],
     [dbo].[USUARIOSxROL]

WHERE USUARIO.CEDULA=USUARIOSxROL.CEDULA_USUARIO AND
      CODIGO_VERIFICACION = @P_CODIGO_VERIFICACION;
go

--RET CORREO_USUARIO BY ID
CREATE PROCEDURE [dbo].[RET_USUARIO_CORREO_PR]
	@P_CEDULA INT
AS
	SELECT CORREO FROM USUARIO WHERE CEDULA = @P_CEDULA;
go

CREATE PROCEDURE [dbo].[RET_USUARIO_PR]
@P_NOMBRE NVARCHAR(50),
@P_CEDULA INT
AS 
SELECT CEDULA,NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,FECHA_NACIMIENTO,
CORREO,CONTRASENA,TELEFONO,FOTO_PERFIL,ESTADO,TIPO_IDENTIFICACION,CODIGO_VERIFICACION,ID_ROL FROM
[dbo].[USUARIO],USUARIOSxROL
WHERE NOMBRE=@P_NOMBRE AND CEDULA=@P_CEDULA AND CEDULA=USUARIOSxROL.CEDULA_USUARIO;
go

CREATE PROCEDURE [DBO].[RET_VEHICULO_PR] @P_PLACA NVARCHAR(50)
AS
SELECT TBL_VEHICULO.ID,
       PLACA,
       MARCA,
       MODELO,
       TIPO_VEHICULO,
       TBL_VEHICULO.CEDULA_DUENO,
       ID_FLOTILLA,
       NOMBRE
FROM TBL_VEHICULO,
     TBL_FLOTILLA
WHERE @P_PLACA = PLACA
go

CREATE PROCEDURE [dbo].[UPD_CATEGORIA_PR]
    @P_ID_CATEGORIA NVARCHAR (50),
	@P_NOMBRE_CATEGORIA NVARCHAR(100)

AS
	UPDATE [dbo].[TBL_CATEGORIA] SET NOMBRE_CATEGORIA = @P_NOMBRE_CATEGORIA WHERE ID_CATEGORIA = @P_ID_CATEGORIA;
go

CREATE PROCEDURE [dbo].[UPD_COMERCIO_ESTADO_PR]
	@P_CEDULA_JURIDICA INT,
	@P_ESTADO NVARCHAR(25)
AS
	UPDATE [dbo].[TBL_COMERCIO] SET ESTADO = @P_ESTADO WHERE CEDULA_JURIDICA = @P_CEDULA_JURIDICA;
go

 --UPDATE COMERCIO
CREATE PROCEDURE [dbo].[UPD_COMERCIO_PR]
	@P_ID_CADENA INT,
	@P_ID_CATEGORIA INT,
	@P_NOMBRE_COMERCIAL NVARCHAR(100),
	@P_REGIMEN_TRIBUTARIO NVARCHAR(50),
	@P_TELEFONO NVARCHAR(50),
	@P_HORA_APERTURA TIME(7),
	@P_HORA_CIERRE TIME(7),
	@P_DIRECCION_ESCRITA NVARCHAR(50),
	@P_FOTO NVARCHAR(300),
	@P_CEDULA_JURIDICA NVARCHAR(50)
AS
	UPDATE  [dbo].[TBL_COMERCIO] SET ID_CADENA = @P_ID_CADENA, ID_CATEGORIA = @P_ID_CATEGORIA, NOMBRE_COMERCIAL = @P_NOMBRE_COMERCIAL,
		 REGIMEN_TRIBUTARIO = @P_REGIMEN_TRIBUTARIO, TELEFONO = @P_TELEFONO, HORA_APERTURA = @P_HORA_APERTURA, HORA_CIERRE = @P_HORA_CIERRE,
		DIRECCION_ESCRITA = @P_DIRECCION_ESCRITA, FOTO = @P_FOTO WHERE CEDULA_JURIDICA = @P_CEDULA_JURIDICA;
go

CREATE   PROCEDURE [dbo].[UPD_CONTRASENA_PROC]
	@P_CODIGO_VERIFICACION NVARCHAR(50),
    @P_CONTRASENA nvarchar(50)
AS
	UPDATE [dbo].[USUARIO] SET CONTRASENA=@P_CONTRASENA WHERE CODIGO_VERIFICACION=@P_CODIGO_VERIFICACION;
go

CREATE PROCEDURE [dbo].[UPD_DIRECCION_USUARIO_PR] @P_LATITUD FLOAT,
                                                  @P_LONGITUD FLOAT,
                                                  @P_ID_USUARIO INT
AS
UPDATE [dbo].[TBL_DIRECCION_USUARIO]
SET LATITUD=@P_LATITUD,
    LONGITUD=@P_LONGITUD,
    ID_USUARIO=@P_ID_USUARIO
WHERE ID_USUARIO = @P_ID_USUARIO;
go

--UPDATE ESTADO_USUARIO
CREATE PROCEDURE [dbo].[UPD_ESTADO_PR]
	@P_CEDULA INT,
	@P_ESTADO NVARCHAR(25)
AS
	UPDATE [dbo].[USUARIO] SET ESTADO = @P_ESTADO WHERE CEDULA = @P_CEDULA;
go

--UPDATE ESTADO_USUARIO
CREATE PROCEDURE [dbo].[UPD_ESTADO_PROC]
	@P_CEDULA INT,
	@P_ESTADO NVARCHAR(25)
AS
	UPDATE [dbo].[USUARIO] SET ESTADO = @P_ESTADO WHERE CEDULA = @P_CEDULA;
go

CREATE PROCEDURE [dbo].[UPD_FLOTILLA_PR] @P_NOMBRE NVARCHAR(50),
                                         @P_CEDULA_DUENO INT
AS
UPDATE [dbo].[TBL_FLOTILLA]
SET NOMBRE=@P_NOMBRE,
    CEDULA_DUENO=@P_CEDULA_DUENO
WHERE NOMBRE = @P_NOMBRE;
go

--UPDATE PRODUCTO
CREATE PROCEDURE [dbo].[UPD_PRODUCTO_ESTADO_PR]
	@P_ID_PRODUCTO NVARCHAR(25),
	@P_ESTADO NVARCHAR(25)
AS
	UPDATE [dbo].[TBL_PRODUCTO] SET ESTADO = @P_ESTADO WHERE ID_PRODUCTO = @P_ID_PRODUCTO;
go

CREATE PROCEDURE [dbo].[UPD_PRODUCTO_PR]
    @P_ID_PRODUCTO nvarchar(50),
	@P_NOMBRE_PRODUCTO nvarchar(50),
	@P_ID_CATEGORIA INT,
	@P_PRECIO INT,
	@P_IMAGEN nvarchar(300)
AS
	UPDATE [dbo].[TBL_PRODUCTO] SET NOMBRE_PRODUCTO=@P_NOMBRE_PRODUCTO, ID_CATEGORIA=@P_ID_CATEGORIA, PRECIO=@P_PRECIO, IMAGEN=@P_IMAGEN WHERE ID_PRODUCTO=@P_ID_PRODUCTO;
go

CREATE PROCEDURE [dbo].[UPD_PROMOCION_PR] @P_CODIGO NVARCHAR(50),
                                          @P_ID_PRODUCTO NVARCHAR(50),
                                          @P_DESCUENTO FLOAT,
                                          @P_ESTADO NVARCHAR(50)
AS
UPDATE [dbo].[TBL_PROMOCION]
SET CODIGO=@P_CODIGO,
    ID_PRODUCTO=@P_ID_PRODUCTO,
    DESCUENTO=@P_DESCUENTO,
    ESTADO=@P_ESTADO
WHERE ID_PRODUCTO = @P_ID_PRODUCTO;
go

CREATE PROCEDURE [dbo].[UPD_USUARIO_CODE_PR]
@P_CEDULA INT,
@P_CODIGO_VERIFICACION NVARCHAR(50)
AS
UPDATE [dbo].[USUARIO] 
SET CODIGO_VERIFICACION=@P_CODIGO_VERIFICACION WHERE CEDULA=@P_CEDULA;
go

--UPDATE DE LA DIRECCION DEL USUARIO
CREATE PROCEDURE [dbo].[UPD_USUARIO_DIRECCION_PR] @P_CEDULA INT,
                                                  @P_NOMBRE NVARCHAR(50),
                                                  @P_PRIMER_APELLIDO NVARCHAR(50),
                                                  @P_SEGUNDO_APELLIDO NVARCHAR(50),
                                                  @P_FECHA_NACIMIENTO DATE,
                                                  @P_CORREO NVARCHAR(50),
                                                  @P_CONTRASENA NVARCHAR(50),
                                                  @P_TELEFONO NVARCHAR(50),
                                                  @P_FOTO_PERFIL NVARCHAR(200),
                                                  @P_ESTADO NVARCHAR(50),
                                                  @P_TIPO_IDENTIFICACION NVARCHAR(50),
                                                  @P_CODIGO_VERIFICACION NVARCHAR(50),
                                                  @P_ID_DIRECCION INT
AS
UPDATE [dbo].[USUARIO]
SET CEDULA=@P_CEDULA,
    NOMBRE=@P_NOMBRE,
    PRIMER_APELLIDO=@P_PRIMER_APELLIDO,
    SEGUNDO_APELLIDO=@P_SEGUNDO_APELLIDO,
    FECHA_NACIMIENTO=@P_FECHA_NACIMIENTO,
    CORREO=@P_CORREO,
    CONTRASENA=@P_CONTRASENA,
    TELEFONO=@P_TELEFONO,
    FOTO_PERFIL=@P_FOTO_PERFIL,
    ESTADO=@P_ESTADO,
    TIPO_IDENTIFICACION=@P_TIPO_IDENTIFICACION,
    CODIGO_VERIFICACION=@P_CODIGO_VERIFICACION,
    ID_DIRECCION=@P_ID_DIRECCION
WHERE CEDULA = @P_CEDULA;
go

--UPDATE ESTADO_USUARIO
CREATE PROCEDURE [dbo].[UPD_USUARIO_ESTADO_PR]
	@P_CEDULA INT,
	@P_ESTADO NVARCHAR(50)
AS
	UPDATE [dbo].[USUARIO] SET ESTADO = @P_ESTADO WHERE CEDULA = @P_CEDULA;
go

CREATE PROCEDURE [dbo].[UPD_USUARIO_PR] @P_CEDULA INT,
                                        @P_NOMBRE NVARCHAR(50),
                                        @P_PRIMER_APELLIDO NVARCHAR(50),
                                        @P_SEGUNDO_APELLIDO NVARCHAR(50),
                                        @P_FECHA_NACIMIENTO DATE,
                                        @P_CORREO NVARCHAR(50),
                                        @P_CONTRASENA NVARCHAR(50),
                                        @P_TELEFONO NVARCHAR(50),
                                        @P_FOTO_PERFIL NVARCHAR(200),
                                        @P_ESTADO NVARCHAR(50),
                                        @P_TIPO_IDENTIFICACION NVARCHAR(50),
                                        @P_CODIGO_VERIFICACION NVARCHAR(50)
AS
UPDATE [dbo].[USUARIO]
SET CEDULA=@P_CEDULA,
    NOMBRE=@P_NOMBRE,
    PRIMER_APELLIDO=@P_PRIMER_APELLIDO,
    SEGUNDO_APELLIDO=@P_SEGUNDO_APELLIDO,
    FECHA_NACIMIENTO=@P_FECHA_NACIMIENTO,
    CORREO=@P_CORREO,
    CONTRASENA=@P_CONTRASENA,
    TELEFONO=@P_TELEFONO,
    FOTO_PERFIL=@P_FOTO_PERFIL,
    ESTADO=@P_ESTADO,
    TIPO_IDENTIFICACION=@P_TIPO_IDENTIFICACION,
    CODIGO_VERIFICACION=@P_CODIGO_VERIFICACION
WHERE CEDULA = @P_CEDULA;
go

CREATE PROCEDURE [dbo].[UPD_VEHICULO_PR] @P_PLACA NVARCHAR(50),
                                         @P_MARCA NVARCHAR(50),
                                         @P_MODELO NVARCHAR(50),
                                         @P_TIPO_VEHICULO NVARCHAR(50),
                                         @P_CEDULA_DUENO INT,
                                         @P_ID_FLOTILLA INT
AS
UPDATE [dbo].[TBL_VEHICULO]
SET PLACA=@P_PLACA,
    MARCA=@P_MARCA,
    MODELO=@P_MODELO,
    TIPO_VEHICULO=@P_TIPO_VEHICULO,
    CEDULA_DUENO=@P_CEDULA_DUENO,
    ID_FLOTILLA=@P_ID_FLOTILLA
where PLACA = @P_PLACA;
go

CREATE   PROCEDURE [dbo].[VERIFICAR_CORREO_PROC] 
    @P_CORREO NVARCHAR(50)
AS
SELECT CEDULA,
       NOMBRE,
       PRIMER_APELLIDO,
       SEGUNDO_APELLIDO,
       FECHA_NACIMIENTO,
       CORREO,
       CONTRASENA,
       TELEFONO,
       FOTO_PERFIL,
       ESTADO,
       TIPO_IDENTIFICACION,
       CODIGO_VERIFICACION,
       USUARIOSxROL.ID_ROL
FROM USUARIO,
     USUARIOSxROL
WHERE CORREO = @P_CORREO 
AND USUARIO.CEDULA = USUARIOSxROL.CEDULA_USUARIO;
go

